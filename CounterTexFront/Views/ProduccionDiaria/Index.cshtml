@model CounterTexFront.Models.ProduccionListViewModel

@{
    Layout = ViewBag.Layout;
    ViewBag.Title = "Listado de Producción Diaria";
}

@section Styles {
    <style>
        body {
            background-color: #1e1e2f;
            color: #f2f2f2;
        }

        .accordion-item-custom {
            background-color: #2a2a3c;
            border: 1px solid rgba(160, 204, 242, 0.2);
            margin-bottom: 10px;
            border-radius: 10px;
        }

        .accordion-header-custom .accordion-button {
            background-color: #2a2a3c;
            color: #ffffff;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .accordion-button:not(.collapsed) {
            background-color: #343a40;
            color: #A0CCF2;
        }

        .accordion-body-custom {
            background-color: #1c1c2e;
            color: #e0e0e0;
            border-top: 1px solid #444;
        }

            .accordion-body-custom p strong {
                color: #A0CCF2;
            }

        .btn-sm {
            font-size: 0.85rem;
        }

        .badge {
            font-size: 0.85rem;
            padding: 0.45em 0.65em;
        }

        .accordion-body-custom .btn {
            margin-right: 0.5rem;
        }

        .btn-primary.mb-3 {
            margin-bottom: 1rem !important;
        }
    </style>
}

<h2 class="mb-4"><i class="bi bi-calendar-check"></i> Lista de Producciones Diarias</h2>

<p>
    @Html.ActionLink("➕ Crear Nueva Producción", "Create", null, new { @class = "btn btn-outline-primary mb-3" })
</p>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">
        @ViewBag.Error
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="accordion" id="accordionProducciones">
    @if (Model.ListaProducciones != null && Model.ListaProducciones.Any())
    {
        int i = 0;
        foreach (var item in Model.ListaProducciones)
        {
            string collapseId = $"collapse_produccion_{item.Id}_{i}";
            string headingId = $"heading_produccion_{item.Id}_{i}";

            <div class="accordion-item accordion-item-custom">
                <h2 class="accordion-header accordion-header-custom" id="@headingId">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@collapseId" aria-expanded="false" aria-controls="@collapseId">
                        <span class="me-2"><i class="bi bi-box-seam"></i></span>
                        <span class="me-3 badge bg-secondary">@item.FechaProduccion.ToShortDateString()</span>
                        <span class="me-3 badge bg-info text-dark">@item.Usuario</span>
                        <span class="me-3 badge bg-success">@item.Prenda</span>
                        <span class="badge bg-warning text-dark"><i class="bi bi-123"></i> @item.Total</span>
                    </button>
                </h2>
                <div id="@collapseId" class="accordion-collapse collapse" aria-labelledby="@headingId" data-bs-parent="#accordionProducciones">
                    <div class="accordion-body accordion-body-custom">
                        <p><strong>ID Producción:</strong> @item.Id</p>
                        <p><strong>Fecha Completa:</strong> @item.FechaProduccion</p>
                        <p><strong>Usuario Asignado:</strong> @item.Usuario</p>
                        <p><strong>Prenda Fabricada:</strong> @item.Prenda</p>
                        <p><strong>Cantidad Total:</strong> @item.Total</p>

                        <hr />
                        <div>
                            @Html.ActionLink("🔍 Ver Detalles", "Details", new { id = item.Id }, new { @class = "btn btn-outline-info btn-sm", title = "Ver información completa" })
                            @Html.ActionLink("🗑️ Eliminar", "Delete", new { id = item.Id }, new { @class = "btn btn-outline-danger btn-sm", onclick = "return confirm('¿Estás seguro de que quieres eliminar esta producción?');" })
                        </div>
                    </div>
                </div>
            </div>
            i++;
        }
    }
    else
    {
        <div class="alert alert-info mt-3">No hay producciones registradas.</div>
    }
</div>

<nav aria-label="Page navigation" class="p-3">
    <ul class="pagination justify-content-center mb-0">
        <li class="page-item @(Model.PaginaActual == 1 ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new { page = Model.PaginaActual - 1 })">Anterior</a>
        </li>
        @for (int i = 1; i <= Model.TotalPaginas; i++)
        {
            <li class="page-item @(i == Model.PaginaActual ? "active" : "")">
                <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
            </li>
        }
        <li class="page-item @(Model.PaginaActual == Model.TotalPaginas ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new { page = Model.PaginaActual + 1 })">Siguiente</a>
        </li>
    </ul>
</nav>

@section Scripts {
    <!-- Bootstrap Icons (si no las tienes aún) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <script>
        // Auto-scroll al expandir un acordeón
        const accordion = document.getElementById('accordionProducciones');
        accordion.addEventListener('shown.bs.collapse', function (e) {
            const target = e.target;
            const offset = target.getBoundingClientRect().top + window.scrollY - 100;
            window.scrollTo({ top: offset, behavior: 'smooth' });
        });
    </script>
}
