

@model CounterTexFront.Models.RevisionEmpleadoViewModel

@{
    ViewBag.Title = "RevisionEmpleado";
    Layout = "~/Views/Shared/_LayoutEmpleado.cshtml";

}




<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CounterTex - Revisión</title>
    <!-- Bootstrap CSS -->
</head>
<body>





        <!-- Contadores -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card card-counter">
                    <div class="card-body">
                        <h5 class="card-title">Por Revisar</h5>
                        <h3 class="card-text" id="contadorPorRevisar">24</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-counter">
                    <div class="card-body">
                        <h5 class="card-title">Aprobadas</h5>
                        <h3 class="card-text" id="contadorAprobadas">156</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-counter">
                    <div class="card-body">
                        <h5 class="card-title">Rechazadas</h5>
                        <h3 class="card-text" id="contadorRechazadas">12</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-counter">
                    <div class="card-body">
                        <h5 class="card-title">Total</h5>
                        <h3 class="card-text" id="contadorTotal">192</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Filtrar Prendas</h5>
                <div class="row">
                    <div class="col-md-3">
                        <label for="tipoPrenda" class="form-label">Tipo de Prenda</label>
                        <select class="form-select" id="tipoPrenda">
                            <option selected>Todas</option>
                            <option>Médico</option>
                            <option>Operación</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="estadoRevision" class="form-label">Estado Revisión</label>
                        <select class="form-select" id="estadoRevision">
                            <option selected>Todos</option>
                            <option>Por Revisar</option>
                            <option>Aprobado</option>
                            <option>Rechazado</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="operador" class="form-label">Operador</label>
                        <select class="form-select" id="operador">
                            <option selected>Todos</option>
                            <option>Operador 1</option>
                            <option>Operador 2</option>
                            <option>Operador 3</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary w-100" id="btnFiltrar">Filtrar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de Prendas -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="tablaPrendas">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo</th>
                                <th>Descripción</th>
                                <th>Operador</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos se llenarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Modal Revisión -->
        <div class="modal fade" id="modalRevision" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Revisar Prenda <span id="modalPrendaId"></span></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formRevision">
                            <div class="mb-3">
                                <label class="form-label">Tipo:</label>
                                <p class="form-control-static" id="modalTipo"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Descripción:</label>
                                <p class="form-control-static" id="modalDescripcion"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Operador:</label>
                                <p class="form-control-static" id="modalOperador"></p>
                            </div>
                            <div class="mb-3">
                                <label for="resultadoRevision" class="form-label">Resultado:</label>
                                <select class="form-select" id="resultadoRevision" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Aprobado">Aprobado</option>
                                    <option value="Rechazado">Rechazado</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="comentariosRevision" class="form-label">Comentarios:</label>
                                <textarea class="form-control" id="comentariosRevision" rows="3" required></textarea>
                            </div>
                            <input type="hidden" id="prendaIdRevision">
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btnConfirmarRevision">Guardar Revisión</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS y dependencias -->
   
    <script>
        // Datos de ejemplo
        const prendasRevision = [
            { id: 1001, tipo: "Médico", descripcion: "Bata quirúrgica", operador: "Operador 1", estado: "Por Revisar" },
            { id: 1002, tipo: "Operación", descripcion: "Guantes latex", operador: "Operador 2", estado: "Por Revisar" },
            { id: 1003, tipo: "Médico", descripcion: "Mascarilla N95", operador: "Operador 3", estado: "Aprobado" },
            { id: 1004, tipo: "Operación", descripcion: "Gorro quirúrgico", operador: "Operador 1", estado: "Rechazado", comentario: "Costura defectuosa" }
        ];

        // Inicializar tabla
        document.addEventListener('DOMContentLoaded', function () {
            const tabla = document.getElementById('tablaPrendas').getElementsByTagName('tbody')[0];
            actualizarTabla(tabla, prendasRevision);
            actualizarContadores(prendasRevision);

            // Evento para el botón de filtrar
            document.getElementById('btnFiltrar').addEventListener('click', function () {
                const tipo = document.getElementById('tipoPrenda').value;
                const estado = document.getElementById('estadoRevision').value;
                const operador = document.getElementById('operador').value;

                const filtradas = prendasRevision.filter(p =>
                    (tipo === 'Todas' || p.tipo === tipo) &&
                    (estado === 'Todos' || p.estado === estado) &&
                    (operador === 'Todos' || p.operador === operador)
                );

                actualizarTabla(tabla, filtradas);
            });

            // Modal de revisión
            const modalRevision = new bootstrap.Modal(document.getElementById('modalRevision'));

            // Evento para abrir modal de revisión
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('btn-revisar')) {
                    const id = e.target.getAttribute('data-id');
                    const prenda = prendasRevision.find(p => p.id == id);

                    if (prenda) {
                        document.getElementById('prendaIdRevision').value = id;
                        document.getElementById('modalPrendaId').textContent = id;
                        document.getElementById('modalTipo').textContent = prenda.tipo;
                        document.getElementById('modalDescripcion').textContent = prenda.descripcion;
                        document.getElementById('modalOperador').textContent = prenda.operador;

                        // Resetear formulario
                        document.getElementById('resultadoRevision').value = '';
                        document.getElementById('comentariosRevision').value = '';

                        modalRevision.show();
                    }
                }
            });

            // Confirmar revisión
            document.getElementById('btnConfirmarRevision').addEventListener('click', function () {
                const id = document.getElementById('prendaIdRevision').value;
                const resultado = document.getElementById('resultadoRevision').value;
                const comentarios = document.getElementById('comentariosRevision').value;

                if (!resultado || !comentarios) {
                    alert('Complete todos los campos');
                    return;
                }

                // Actualizar estado en los datos
                const prenda = prendasRevision.find(p => p.id == id);
                if (prenda) {
                    prenda.estado = resultado;
                    prenda.comentario = comentarios;
                    actualizarTabla(tabla, prendasRevision);
                    actualizarContadores(prendasRevision);
                    modalRevision.hide();
                    alert(`Prenda ${id} marcada como ${resultado}`);
                }
            });
        });

        function actualizarTabla(tabla, datos) {
            tabla.innerHTML = '';
            datos.forEach(prenda => {
                const row = tabla.insertRow();
                row.innerHTML = `
                                <td>${prenda.id}</td>
                                <td>${prenda.tipo}</td>
                                <td>${prenda.descripcion}</td>
                                <td>${prenda.operador}</td>
                                <td><span class="badge ${getBadgeClassRevision(prenda.estado)} status-badge">${prenda.estado}</span></td>
                                <td>
                                    ${prenda.estado === 'Por Revisar' ?
                        `<button class="btn btn-sm btn-primary btn-revisar" data-id="${prenda.id}">Revisar</button>` :
                        `<button class="btn btn-sm btn-info" data-bs-toggle="tooltip" title="${prenda.comentario || 'Sin comentarios'}">Ver Detalles</button>`}
                                </td>
                            `;
            });

            // Inicializar tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }

        function actualizarContadores(datos) {
            const porRevisar = datos.filter(p => p.estado === 'Por Revisar').length;
            const aprobadas = datos.filter(p => p.estado === 'Aprobado').length;
            const rechazadas = datos.filter(p => p.estado === 'Rechazado').length;

            document.getElementById('contadorPorRevisar').textContent = porRevisar;
            document.getElementById('contadorAprobadas').textContent = aprobadas;
            document.getElementById('contadorRechazadas').textContent = rechazadas;
            document.getElementById('contadorTotal').textContent = datos.length;
        }

        function getBadgeClassRevision(estado) {
            switch (estado) {
                case 'Por Revisar': return 'bg-warning text-dark';
                case 'Aprobado': return 'bg-success';
                case 'Rechazado': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
    </script>
</body>
</html>